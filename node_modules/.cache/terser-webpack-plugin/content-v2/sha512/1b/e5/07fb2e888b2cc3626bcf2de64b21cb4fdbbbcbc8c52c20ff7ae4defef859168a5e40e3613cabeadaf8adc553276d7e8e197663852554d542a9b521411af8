{"code":"!function(t){var e={};function o(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=t,o.c=e,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&\"object\"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,\"default\",{enumerable:!0,value:t}),2&e&&\"string\"!=typeof t)for(var i in t)o.d(n,i,function(e){return t[e]}.bind(null,i));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,\"a\",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p=\"\",o(o.s=0)}([function(t,e,o){\"use strict\";o.r(e);class n{constructor(){this.arr=[]}add(t){this.arr.push(t)}publish(){this.arr.forEach(t=>t.update())}}class i{constructor(t){this.transform(t.$data,t)}transform(t,e){t&&\"object\"==typeof t&&Object.keys(t).forEach(o=>{let i=t[o];\"object\"==typeof i&&this.transform(i,e);const r=new n;Object.defineProperty(t,o,{enumerable:!0,configurable:!0,get:()=>(n.target&&r.add(n.target),i),set(t){const o=i;if(e.beforeUpdate.call(e,o,t),t!==i)return\"object\"==typeof t&&this.transform(t,e),i=t,r.publish(),e.updated.call(e,o,t),i}})})}}class r{constructor(t,e,o,i){this.node=t,this.expr=e,this.vm=o,this.cb=i||(()=>{}),n.target=this,this.oldValue=this.getValue(),n.target=null}getValue(){return this.expr.split(\".\").reduce((t,e)=>t[e],this.vm.$data)}update(){const t=this.getValue();t!==this.oldValue&&(this.oldValue=t,this.cb(t))}}let s=0;class l{constructor(t,e){this.fragement=t,this.vm=e,this.compile(this.fragement.childNodes)}getCompiledFragement(){return this.fragement}isDetective(t){return t.includes(\"v-\")}isCustomComponent(t){return v()[t.nodeName.toLowerCase()]}isElementNode(t){return 1===t.nodeType}getValueByExp(t){return t.split(\".\").reduce((t,e)=>t[e],this.vm.$data)}nodeInteractive(t,e){t.addEventListener(\"input\",t=>{const o=e.split(\".\"),n=o.length;let i=0;o.reduce((e,o)=>{if(i++,i!==n)return e[o];e[o]=t.target.value},this.vm.$data)})}compileAttributes(t){const e=t.attributes;null!=e&&[...e].forEach(({name:e,value:o})=>{if(!this.isDetective(e))return;const n=e.replace(\"v-\",\"\");new r(t,o,this.vm,()=>{a[n].call(this,t,this.getValueByExp(o))}),a[n].call(this,t,this.getValueByExp(o)),this.nodeInteractive(t,o)})}compileComponentAttributes(t,e){const o=t.attributes;if(null==o)return;const n=e[1];[...o].forEach(({name:t,value:e})=>{n.setAttribute(t,e)}),this.compileAttributes(n)}compileComponent(t){const e=t.nodeName.toLowerCase(),o=v()[e];if(s<10&&null!=o){s++,o.beforeCreated&&o.beforeCreated();const e=new h(o);e.$parent=this.vm,this.vm.addChild(e),e.created();const n=e.render();e.beforeMounted();const i=n.childNodes.length;return this.compileComponentAttributes(t,n.childNodes),t.replaceWith(n),e.mounted(),i}}compileNode(t){this.compileAttributes(t),this.compile(t.childNodes)}updateText(t,e){t.textContent=e.replace(/{{([^}]+)}}/g,(...t)=>this.getValueByExp(t[1]))}compileText(t){const e=t.textContent;t.textContent=e.replace(/{{([^}]+)}}/g,(...o)=>(new r(t,o[1],this.vm,()=>{this.updateText(t,e)}),this.getValueByExp(o[1])))}compile(t){for(let e=0,o=t.length;e<o;e++){const n=t[e];if(this.isCustomComponent(n)){const t=this.compileComponent(n)-1;e+=t,o+=t}else this.isElementNode(n)?this.compileNode(n):this.compileText(n)}}}const a={model(t,e){t.value=e},show(t,e){t.style.display=e?\"block\":\"none\"},if(t,e){return this.vm.$emit(\"rerender\"),console.log(\"start\"),this.vm.render(),e}};class c{constructor(){this.pool={}}initPool(t){return null==this.pool[t]&&(this.pool[t]=[]),this.pool[t]}$on(t,e){this.initPool(t).push(e)}$off(t,e){if(null==t&&null==e)return this.pool={};null!=this.pool[t]&&(this.pool[t]=null!=e?this.pool[t].filter(t=>t!==e):[])}$once(t,e){const o=this.initPool(t),n=(...o)=>{e(...o),this.$off(t,n)};o.push(n)}$emit(t,...e){this.$parent&&this.$parent.$emit(t,...e),null!=this.pool[t]&&this.pool[t].forEach(t=>t(...e))}}class d extends c{constructor(){super(),this.$children=[],this.$parent=null}addChild(t){this.$children.push(t)}}let u=0;class h extends d{constructor(t){super(),this.$vid=u++,this.$data=t.data,\"function\"==typeof t.data&&(this.$data=t.data()),this.initLifeCircle(t),this.proxyData(),this.$template=this.compileTemplate(t),new i(this),this.created()}initLifeCircle(t){[\"created\",\"beforeMounted\",\"mounted\",\"beforeUpdate\",\"updated\",\"beforeDestory\",\"destoryed\"].forEach(e=>this[e]=t[e]||(()=>{}))}render(){const t=new l(this.$template,this).getCompiledFragement();return this.$el=t.children[0],t}compileTemplate(t){const e=document.createElement(\"div\");e.innerHTML=t.template;const o=document.createDocumentFragment();for(;e.firstChild;)o.append(e.firstChild);return o}proxyData(){Object.keys(this.$data).forEach(t=>{Object.defineProperty(this,t,{enumerable:!0,configurable:!0,get(){return this.$data[t]},set(e){this.$data[t]=e}})})}}const p=\"rerender\",m={};class f extends c{constructor(t){super();const e=this.$root=new h(t);e.$parent=this,this.$on(p,this.render);const o=e.render();this.$rootNode=document.querySelector(t.el),this.$rootNode.append(o)}render(){console.log(\"re-render\",this)}static component(t,e){m[t]=e}}const v=()=>m;window.globalComponents=v,f.component(\"colorful-div\",{template:'\\n        <div>\\n            {{color}}\\n            <blue-div v-if=\"show\"></blue-div>\\n            <input v-model=\"color\" />\\n        </div>\\n    ',data:()=>({color:\"red\",show:!1}),mounted(){setInterval(()=>{this.show=!this.show},1500)}}),f.component(\"blue-div\",{template:'\\n        <div style=\"color:blue\">\\n            {{color}}:{{idx}}\\n            <colorful-div> </colorful-div>\\n        </div>\\n    ',data:()=>({color:\"blue\",idx:0}),mounted(){setTimeout(()=>{this.idx++},500)}});let b=new f({el:\"#app\",template:'\\n    <div>\\n        <input id=\"input1\" type=\"text\" v-model=\"message.a\">\\n        <input id=\"input2\" v-model=\"b\" />\\n        {{message.a}} - {{b}}\\n        <div id=\\'div1\\'>\\n            {{message.a}}\\n        </div>\\n        <colorful-div> </colorful-div>\\n        <blue-div></blue-div>\\n    </div>\\n    ',data:{message:{a:\"j1111w\"},b:\"holy shit\"}});window.vm=b,window.wue=f}]);","extractedComments":[]}